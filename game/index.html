<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>ì†ê³¼ ì–¼êµ´ ì¸ì‹</title>
  <link rel="stylesheet" href="style.css">
  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/hand-pose-detection"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-detection"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection"></script>

  <!-- 3D Game Library (Three.js) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.138.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.138.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://unpkg.com/fflate@0.7.4/umd/index.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.138.0/examples/js/loaders/FBXLoader.js"></script>

</head>

<body>

  <div id="game-container" style="position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1;"></div>

  <div id="video-widget-container">
    <h1>ì† & ì–¼êµ´ ì¸ì‹</h1>
    <div id="main-container">
      <div id="container">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
        <div id="warning-overlay">
          <div id="warning-text"></div>
        </div>
      </div>
    </div>
    <div id="controls-container">
      <div id="gesture-display" class="status-display">ì¤€ë¹„ ì¤‘...</div>
    </div>
    <div id="square-container">
      <div id="tiger-square" class="square"><img src="animal/í˜¸ë‘ì´.png" alt="Tiger"></div>
      <div id="rabbit-square" class="square"><img src="animal/í† ë¼.png" alt="Rabbit"></div>
      <div id="snake-square" class="square"><img src="animal/ë±€.png" alt="Snake"></div>
      <div id="elephant-square" class="square"><img src="animal/ì½”ë¼ë¦¬.png" alt="Elephant"></div>
    </div>
  </div>

  <div id="progress-bar-container">
    <div id="rainbow-progress-bar"></div>
    <div id="emoji-indicator"></div>
  </div>

  <!-- ê²Œì„ ì˜¤ë²„ ì˜¤ë²„ë ˆì´ -->
  <div id="game-over-overlay" style="display: none;">
    <div class="game-over-container">
      <div class="skull">ğŸ’€</div>
      <h1 class="game-over-title">Game Over</h1>
      <p class="game-over-subtitle">ì¥ì• ë¬¼ì— ë¶€ë”ªí˜”ìŠµë‹ˆë‹¤!</p>

      <div class="game-over-buttons">
        <button id="restart-btn" class="btn btn-primary">ğŸ”„ ë‹¤ì‹œ í”Œë ˆì´</button>
        <a href="start.html" class="btn btn-home">ğŸ  íƒ€ì´í‹€ë¡œ ëŒì•„ê°€ê¸°</a>
      </div>
    </div>
  </div>

  <script type="module" src="hand-face-recognition.js"></script>
  <script type="module" src="main.js"></script>
  <audio id="game-music" src="music/desert-storm.wav" loop></audio>

  <script>
    // ê²Œì„ ìŒì•… ì¬ìƒ í•¨ìˆ˜ë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •
    window.playGameMusic = function () {
      const gameMusic = document.getElementById('game-music');
      if (gameMusic && gameMusic.paused) {
        gameMusic.play().catch(e => console.error("Game music playback failed:", e));
        console.log("ê²Œì„ ìŒì•…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
    };

    // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ëŒ€ê¸°
    document.addEventListener('DOMContentLoaded', function () {
      // ì‚¬ìš©ìê°€ í´ë¦­í•˜ê±°ë‚˜ í‚¤ë¥¼ ëˆ„ë¥´ë©´ ìŒì•… ì¬ìƒ ì¤€ë¹„
      document.addEventListener('click', window.playGameMusic, { once: true });
      document.addEventListener('keydown', window.playGameMusic, { once: true });
    });
  </script>
</body>

</html>